\chapter{Evaluation}	
The evaluation is divided into two sections, one for each development method used. In each section, the developed application, it's structure and functionality is presented, followed by the results of the code evaluation. 

\section{Native android} \label{android}
The developed native application can be cloned from Github at [..], also a compressed version of all source code used in the thesis can be found at [..]. An overview of the application structure and functionality follows in section ~\ref{sec:nativestructure}. 

\subsection{Application structure} \label{sec:nativestructure}
A UML-diagram representing the Android application can be seen in figure ~\ref{fig:nativeuml}, with the classes summarized below.

\begin{description}
	\item[MainActivity] is the main class of the program, containing Android-specific code related to startup logic, activities to be started and shutdown of the application. It also serves as a messenger, sending back data from native functions upon completion.
	
	\item[IntentFactory] provides intents for native functions 
	
	\item[AndroidHardware] handles hardware related logic, such as file creation.
	
	\item[Bridge] serves as a bridge between the native application and web. When a native function is requested, Bridge requests the corresponding Intent from IntentFactory, and creates a Callback of the corresponding type. The Intent is sent to MainActivity for execution, and the Callback is stored in MainActivity.
	
	\item[WebViewDataSender] is the class communicating back to the web application by invoking javascript-functions in the browser.
	
	\item[JsInterface] is exposed to the web application as a JavaScriptInterface and acts as a receiver for function calls from the web application. Whenever native functionality is needed, the javascript in the web application can call upon it's methods. JsInterface forwards the function calls to Bridge, which in turn, contains the logic for each function.
	
	\item[Callback] contains logic specifying how to send results from a native function back to the web application.
	
	\begin{description}
		\item[ImageCallback] is used when the web application requests an image from the camera.
		
		\item[ImagePickCallback] is used when the web application requests an image from the gallery.
		
	\end{description}
	\item[UniqueInteger] is used by MainActivity when storing callbacks. An unique integer is used as an id for an Intent and its related callback. Upon completion of an Intent, the Callback with the same id is executed.
	
\end{description}

\begin{figure}[h!]
	\centering
    \includegraphics[width=120mm,natwidth=800,natheight=600]{./img/polluxuml.png}
    \caption{Structure of the android application}
    \label{fig:nativeuml}
\end{figure}

In order to simplify development of the web application with support for both web browsers and the Android application, part of the logic follows the adapter pattern. The business logic of the web application stays the same, and only the communication with the unit (web browser or application), for example when uploading a picture, differs. Figure ~\ref{fig:nativewebuml} displays the basic structure of the web application. 

\begin{figure}[h!]
	\centering
    \includegraphics[width=60mm,natwidth=400,natheight=300]{./img/androidwebuml.png}
    \caption{Structure of the web application}
	\label{fig:nativewebuml}
\end{figure}

A more detailed view of the program flow when the web application requests an image can be seen in figure ~\ref{fig:nativeflow}, further explained below.
\begin{figure}[h!]
	\centering
    \includegraphics[width=120mm,natwidth=800,natheight=600]{./img/androidfunctionflow.png}
    \caption{Function flowchart, single call from web application}
    \label{fig:nativeflow}
\end{figure}
\begin{enumerate}
	\item User action invokes a request for an image from the mobile camera
	\item Current device adapter (AndroidDeviceAdapter) calls requestCamera on JsInterface, with the function name of the preferred callback function as argument
	\item JsInterface forwards the function call to Bridge
	\item Bridge creates the corresponding Intent and Callback, and calls processIntent on MainActivity with Intent and Callback as arguments
	\item MainActivity Creates gets a unique id from UniqueInteger, stores the callback in a hashmap with the id as key, and starts the intent with the id as requestcode.
	\item Camera application starts
	\item When user takes a picture, MainActivity gets notified by the Android system, pulls the Callback with the same id as the processed Intent, and forwards the callback and resulting image data to Bridge through processCallback
	\item Bridge executes the callback which in turn calls sendData on WebViewDataSender, with the image data and callback name as arguments
	\item WebViewDataSender executes the javascript callback function in the browser window
	\item The captured image is displayed to the user in the browser
\end{enumerate}

\subsection{Code evaluation}
Evaluation of the developed application was performed as described in [...], and a summary of the results  can be seen in table ~\ref{tab:lloc1}.

\begin{table}[!htb]
    \centering
        \begin{tabular}{lrc}\hline
			\end{tabular}
    \caption{Code evaluation - Native application}\label{tab:lloc1}
\end{table}

\section{PhoneGap}
The application developed in PhoneGap can 

\subsection{Application structure}

\begin{figure}[h!]
	\centering
    \includegraphics[width=120mm,natwidth=800,natheight=600]{./img/phonegapuml.png}
    \caption{Structure of the phonegap application}
    \label{fig:phonegapuml}
\end{figure}

\begin{figure}[h!]
	\centering
    \includegraphics[width=60mm,natwidth=400,natheight=300]{./img/phonegapwebuml.png}
    \caption{Structure of the web application}
        \label{fig:phonegapwebuml}
\end{figure}

\begin{figure}[h!]
	\centering
    \includegraphics[width=120mm,natwidth=800,natheight=600]{./img/phonegapfunctionflow.png}
    \caption{Function flowchart, single call in web application}
\end{figure}

\subsection{Code evaluation}
Evaluation of the developed application was performed as described in [...], and a summary of the results  can be seen in table ~\ref{tab:lloc2}.

\begin{table}[!htb]
    \centering
        \begin{tabular}{lrc}\hline
			\end{tabular}
    \caption{Code evaluation - PhoneGap application}\label{tab:lloc2}
\end{table}